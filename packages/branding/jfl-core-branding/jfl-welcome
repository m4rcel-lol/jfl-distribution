#!/bin/bash

# Just Fucking Linux Welcome Script
# First-time setup and system information
# Version: 1.0.0

# Configuration
JFL_VERSION="1.0.0"
JFL_CONFIG="/etc/jfl/release"
JFL_MOTD="/etc/jfl/motd"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36c'
WHITE='\033[1;37m'
BOLD='\033[1m'
NC='\033[0m'

# Welcome messages
WELCOME_MESSAGES=(
    "Welcome to Just Fucking Linux! Let's get this shit set up."
    "So you chose JFL. Let's configure this fuckware."
    "Welcome to the best fucking Linux distro."
    "JFL installation complete. Spread evilness."
    "Welcome! Your Fucking Linux is ready for customization."
    "m5rcel didn't tell me I will have a visitor, anyways. Configure me well."
    "JFL is installed. Let's make it unusable."
)

# Print colored header
print_header() {
    echo -e "${RED}${BOLD}╔══════════════════════════════════════════════════════════════╗${NC}"
    echo -e "${RED}${BOLD}║${WHITE}                    Just Fucking Linux Welcome                ${RED}${BOLD}║${NC}"
    echo -e "${RED}${BOLD}║${WHITE}                        Version ${JFL_VERSION}                    ${RED}${BOLD}║${NC}"
    echo -e "${RED}${BOLD}╚══════════════════════════════════════════════════════════════╝${NC}"
}

# Print message
print_message() {
    local color="$1"
    local message="$2"
    echo -e "${color}JFL: ${message}${NC}"
}

# Show system information
show_system_info() {
    print_message "$BLUE" "System Information:"
    echo
    
    # OS Info
    if [[ -f "$JFL_CONFIG" ]]; then
        echo -e "${WHITE}Operating System:${NC}"
        cat "$JFL_CONFIG"
        echo
    fi
    
    # Hardware info
    echo -e "${WHITE}Hardware Information:${NC}"
    echo -e "  CPU: $(grep 'model name' /proc/cpuinfo | head -1 | cut -d':' -f2- | sed 's/^ *//')"
    echo -e "  Memory: $(free -h | awk '/^Mem:/ {print $3 "/" $2}')"
    echo -e "  Disk: $(df -h / | awk 'NR==2 {print $3 "/" $2 " (" $5 " used)"}')"
    echo -e "  Graphics: $(lspci | grep -i vga | cut -d':' -f3- | sed 's/^ *//' | head -1)"
    echo
    
    # Network info
    echo -e "${WHITE}Network Status:${NC}"
    if command -v ip &> /dev/null; then
        local interfaces=$(ip link show | grep -E '^[0-9]+:' | cut -d':' -f2 | sed 's/^ *//' | grep -v lo)
        for interface in $interfaces; do
            local status=$(ip link show "$interface" | grep -o 'state [A-Z]*' | cut -d' ' -f2)
            local ip=$(ip addr show "$interface" | grep 'inet ' | awk '{print $2}' | head -1)
            echo -e "  $interface: ${GREEN}$status${NC} ${YELLOW}$ip${NC}"
        done
    else
        echo -e "  Network information not available"
    fi
    echo
}

# Show package manager info
show_package_info() {
    print_message "$BLUE" "Package Manager Information:"
    echo
    
    echo -e "${WHITE}JFL Package Manager:${NC}"
    echo -e "  Command: ${CYAN}fucking${NC}"
    echo -e "  Alias: ${CYAN}just${NC} (sudo wrapper)"
    echo -e "  Examples:"
    echo -e "    ${CYAN}just fucking install${NC} ${WHITE}<package>${NC}"
    echo -e "    ${CYAN}just fucking upgrade${NC}"
    echo -e "    ${CYAN}fucking search${NC} ${WHITE}<query>${NC}"
    echo
    
    echo -e "${WHITE}Package Statistics:${NC}"
    if command -v pacman &> /dev/null; then
        local total_packages=$(pacman -Q | wc -l)
        local explicit_packages=$(pacman -Qe | wc -l)
        echo -e "  Total packages: ${GREEN}$total_packages${NC}"
        echo -e "  Explicitly installed: ${GREEN}$explicit_packages${NC}"
    else
        echo -e "  Package manager not available"
    fi
    echo
}

# Show desktop info
show_desktop_info() {
    print_message "$BLUE" "Desktop Environment:"
    echo
    
    echo -e "${WHITE}Current Desktop:${NC} ${GREEN}$XDG_CURRENT_DESKTOP${NC}"
    echo -e "${WHITE}Display Server:${NC} ${GREEN}$XDG_SESSION_TYPE${NC}"
    echo
    
    if [[ "$XDG_CURRENT_DESKTOP" == *"Budgie"* ]]; then
        echo -e "${WHITE}Budgie Desktop Tips:${NC}"
        echo -e "  • Right-click panel for settings"
        echo -e "  • Use Raven (super + a) for notifications and settings"
        echo -e "  • Alt + Tab for window switching"
        echo -e "  • Super + S for screenshot"
        echo
    fi
    
    echo -e "${WHITE}Theme Information:${NC}"
    echo -e "  GTK Theme: ${CYAN}JFL-Budgie${NC}"
    echo -e "  Icon Theme: ${CYAN}JFL-Icons${NC}"
    echo -e "  Font: ${CYAN}Hack${NC}"
    echo
}

# Show first steps
show_first_steps() {
    print_message "$BLUE" "Recommended First Steps:"
    echo
    
    echo -e "${WHITE}1. Update System:${NC}"
    echo -e "   ${CYAN}just fucking upgrade${NC}"
    echo
    
    echo -e "${WHITE}2. Install Additional Software:${NC}"
    echo -e "   ${CYAN}just fucking install${NC} ${WHITE}<package-name>${NC}"
    echo -e "   Popular packages:"
    echo -e "     • ${CYAN}firefox${NC} - Web browser"
    echo -e "     • ${CYAN}code${NC} - Code editor"
    echo -e "     • ${CYAN}vlc${NC} - Media player"
    echo -e "     • ${CYAN}gimp${NC} - Image editor"
    echo
    
    echo -e "${WHITE}3. Explore Package Manager:${NC}"
    echo -e "   ${CYAN}fucking search${NC} ${WHITE}<query>${NC}    - Search packages"
    echo -e "   ${CYAN}fucking info${NC} ${WHITE}<package>${NC}    - Package details"
    echo -e "   ${CYAN}fucking stats${NC}             - System statistics"
    echo
    
    echo -e "${White}4. Customize Desktop:${NC}"
    echo -e "   • Right-click desktop for wallpaper settings"
    echo -e "   • Use Budgie Settings for desktop configuration"
    echo -e "   • Check JFL themes in Appearance settings"
    echo
}

# Show help and resources
show_help_resources() {
    print_message "$BLUE" "Help and Resources:"
    echo
    
    echo -e "${WHITE}Documentation:${NC}"
    echo -e "  • Local docs: ${CYAN}/usr/share/doc/jfl/${NC}"
    echo -e "  • Online: ${CYAN}https://docs.justfuckinglinux.com${NC}"
    echo
    
    echo -e "${WHITE}Community:${NC}"
    echo -e "  • Reddit: ${CYAN}r/justfuckinglinux${NC}"
    echo -e "  • IRC: ${CYAN}#jfl${NC} on Libera.Chat"
    echo -e "  • GitHub: ${CYAN}github.com/justfuckinglinux${NC}"
    echo
    
    echo -e "${WHITE}Troubleshooting:${NC}"
    echo -e "  • Check logs: ${CYAN}journalctl -xe${NC}"
    echo -e "  • Package issues: ${CYAN}fucking stats${NC}"
    echo -e "  • System info: ${CYAN}neofetch${NC}"
    echo
}

# Interactive setup
interactive_setup() {
    print_message "$YELLOW" "Would you like to perform initial setup? [Y/n]"
    read -r response
    
    if [[ "$response" =~ ^[Nn]$ ]]; then
        print_message "$YELLOW" "Skipping setup. You can run this anytime with 'jfl-welcome'."
        return
    fi
    
    echo
    print_message "$BLUE" "Initial Setup:"
    echo
    
    # Update system
    print_message "$YELLOW" "Update system packages? [Y/n]"
    read -r update_response
    if [[ ! "$update_response" =~ ^[Nn]$ ]]; then
        print_message "$BLUE" "Updating system..."
        if sudo fucking upgrade; then
            print_message "$GREEN" "System updated successfully!"
        else
            print_message "$RED" "System update failed. Check your internet connection."
        fi
        echo
    fi
    
    # Install popular packages
    print_message "$YELLOW" "Install popular software packages? [Y/n]"
    read -r packages_response
    if [[ ! "$packages_response" =~ ^[Nn]$ ]]; then
        print_message "$BLUE" "Installing popular packages..."
        local popular_packages=("firefox" "libreoffice-fresh" "vlc" "gimp")
        
        for package in "${popular_packages[@]}"; do
            print_message "$BLUE" "Installing $package..."
            if sudo fucking install "$package" --noconfirm; then
                print_message "$GREEN" "$package installed"
            else
                print_message "$YELLOW" "$package failed to install"
            fi
        done
        echo
    fi
    
    # Create user directories
    print_message "$YELLOW" "Create user directories? [Y/n]"
    read -r dirs_response
    if [[ ! "$dirs_response" =~ ^[Nn]$ ]]; then
        print_message "$BLUE" "Creating user directories..."
        mkdir -p "$HOME"/{Desktop,Documents,Downloads,Music,Pictures,Videos,Templates,Public}
        print_message "$GREEN" "User directories created"
        echo
    fi
    
    # Set up git (if not configured)
    if [[ -z $(git config --global user.name) ]]; then
        print_message "$YELLOW" "Configure Git? [Y/n]"
        read -r git_response
        if [[ ! "$git_response" =~ ^[Nn]$ ]]; then
            echo -e "${WHITE}Enter your name:${NC}"
            read -r git_name
            echo -e "${WHITE}Enter your email:${NC}"
            read -r git_email
            
            git config --global user.name "$git_name"
            git config --global user.email "$git_email"
            git config --global init.defaultBranch main
            
            print_message "$GREEN" "Git configured"
            echo
        fi
    fi
    
    print_message "$GREEN" "Initial setup completed!"
}

# Easter egg function
show_easter_egg() {
    local random=$((RANDOM % 10))
    case $random in
        0)
            print_message "$PURPLE" "Fun fact: Floyd the Penguin was created when a Linux penguin had enough of your shit."
            ;;
        1)
            print_message "$PURPLE" "Did you know? The 'fucking' package manager has over 50 different sarcastic messages."
            ;;
        2)
            print_message "$PURPLE" "Pro tip: Type 'just insult' for a personalized insult from JFL."
            ;;
        3)
            print_message "$PURPLE" "Legend says that if you break JFL three times, Floyd the Penguin appears to laugh at you."
            ;;
        4)
            print_message "$PURPLE" "The JFL color scheme was inspired by rage and late-night coding sessions."
            ;;
        5)
            print_message "$PURPLE" "JFL: Because 'user-friendly' is just a nice way of saying 'dumbed down'."
            ;;
        6)
            print_message "$PURPLE" "The middle finger in the JFL logo isn't just for show - it's a technical specification."
            ;;
        7)
            print_message "$PURPLE" "JFL developers drink more coffee than your entire family combined."
            ;;
        8)
            print_message "$PURPLE" "If JFL was easy, it would be called Ubuntu."
            ;;
        9)
            print_message "$PURPLE" "JFL: Turning frustration into features since 2024."
            ;;
    esac
    echo
}

# Main function
main() {
    # Check if running in terminal
    if [[ ! -t 0 ]]; then
        echo "This script must be run in a terminal."
        exit 1
    fi
    
    print_header
    echo
    
    # Random welcome message
    local welcome_msg=${WELCOME_MESSAGES[$RANDOM % ${#WELCOME_MESSAGES[@]}]}
    print_message "$YELLOW" "$welcome_msg"
    echo
    
    # Show information sections
    show_system_info
    show_package_info
    show_desktop_info
    show_first_steps
    show_help_resources
    
    # Easter egg
    show_easter_egg
    
    # Interactive setup
    interactive_setup
    
    echo
    print_message "$GREEN" "Welcome to Just Fucking Linux! Enjoy your rebellious computing experience!"
    print_message "$YELLOW" "Run this script anytime with: ${CYAN}jfl-welcome${NC}"
    echo
    
    print_message "$RED" "Remember: If you break it, you get to keep both pieces."
}

# Check for help flag
if [[ "${1:-}" == "--help" || "${1:-}" == "-h" ]]; then
    echo "Just Fucking Linux Welcome Script"
    echo
    echo "Usage: jfl-welcome [options]"
    echo
    echo "Options:"
    echo "  --help, -h    Show this help message"
    echo "  --info        Show system information only"
    echo "  --setup       Run setup only"
    echo
    echo "This script provides first-time setup and system information"
    echo "for Just Fucking Linux distributions."
    exit 0
fi

# Run main function
main "$@"
